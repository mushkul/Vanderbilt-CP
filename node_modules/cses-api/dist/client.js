"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Client = void 0;
const axios_1 = __importDefault(require("axios"));
const form_data_1 = __importDefault(require("form-data"));
const util_js_1 = require("./util.js");
const cookie_1 = __importDefault(require("cookie"));
const path_1 = __importDefault(require("path"));
axios_1.default.defaults.baseURL = 'https://cses.fi';
class Client {
    constructor(tokens) {
        this.csrf = tokens?.csrf;
        let Cookie = tokens?.php ? cookie_1.default.serialize('PHPSESSID', tokens?.php) : '';
        this.api = axios_1.default.create({ headers: { Cookie } });
    }
    get(url, config) {
        return this.api.get(url, config);
    }
    submit(url, data) {
        const form = new form_data_1.default();
        Object.entries(data).forEach(([key, value]) => form.append(key, value));
        // return "ewq";
        form.append('csrf_token', this.csrf);
        console.log(form.getHeaders())

        return this.api.post(url, form, { headers: form.getHeaders() });
    }
    cacheGet(url) {
        let filePath = path_1.default.join(__dirname, '../cache', url + ".cache");
        return new Promise((res) => {
            (0, util_js_1.readFile)(filePath, 'utf8', async (err, data) => {
                if (err) {
                    await (0, util_js_1.mkdirs)(path_1.default.dirname(filePath));
                    const response = await this.get(url);
                    // response
                    await (0, util_js_1.writeFile)(filePath, response.data.toString(), 'utf8');
                    res(response.data);
                }
                else {
                    res(data);
                }
            });
        });
    }
}
exports.Client = Client;
